@using System.Text.Json
@inject AuthService authService
@inject ExperimenterService experimenterService
@inject ISnackbar snackbar
@inject NavigationManager navManager

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h5">
            Modelo
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudText>Tem certeza que deseja desativar sua conta? Esta ação não pode ser desfeita.</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Error" FullWidth="true" OnClick="DeleteAccountAsync" Variant="Variant.Filled">Desativar</MudButton>
        <MudButton Color="Color.Info" FullWidth="true" OnClick="CloseDialogAsync" Variant="Variant.Filled">Cancelar</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public string Password { get; set; } = default!;

    private void CloseDialogAsync()
    {
        MudDialog.Close();
    }

    private async Task DeleteAccountAsync()
    {
        if (authService.User is null) return;

        var result = await experimenterService.DeleteAccountAsync(authService.User.Id, Password);

        if (!result.Success)
        {
            snackbar.Add(result.Errors.FirstOrDefault(), Severity.Error);
        }
        else
        {
            navManager.NavigateTo("/account/logout");
        }
    }
}
